<div class="dashboard-container">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <img src="assets/LogoQuesos1.png" alt="Logo Quesos Bartolomé" />
    </div>

    <h2 class="menu-title">Menú</h2>
    <nav class="menu">
      <ul>

        <li (click)="goToAbout()">
          Acerca de nosotros
        </li>

        <li (click)="goToMyOrder()" *ngIf="isLoggedIn && isUser()">
          Mi pedido
        </li>

        <ng-container *ngIf="isLoggedIn && isAdmin()">

          <li (click)="goToOrders()">
            Pedidos
          </li>

          <li>
            Facturas
          </li>

          <li>
            Gráficos
          </li>

          <li (click)="goToStock()">
            Stock
          </li>

          <li (click)="goToClients()">
            Clientes
          </li>

        </ng-container>

      </ul>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main-content">
    <div class="top-bar">
      <div ngbDropdown>
        <button class="btn btn-outline-danger dropdown-toggle" ngbDropdownToggle>
          {{ selectedType }}
        </button>
        <ul ngbDropdownMenu>
          <li ngbDropdownItem (click)="selectType('Todos')">Todos</li>
          <li ngbDropdownItem (click)="selectType('Pasta prensada')">Pasta prensada</li>
          <li ngbDropdownItem (click)="selectType('Cremoso')">Cremoso</li>
          <li ngbDropdownItem (click)="selectType('Maduración fúngica')">Maduración fúngica</li>
        </ul>
      </div>

      <div class="auth-buttons">
        <ng-container *ngIf="!isLoggedIn; else logoutTemplate">
          <button class="btn btn-outline-rojo" (click)="goToLogin()">Iniciar Sesión</button>
          <button class="btn btn-danger" (click)="goToRegister()">Registrarse</button>
        </ng-container>

        <ng-template #logoutTemplate>
          <button class="btn btn-danger" (click)="logout()">Cerrar Sesión</button>
          <button class="btn btn-danger ms-2" (click)="goToProfile()" aria-label="Mi perfil">
            <i class="bi bi-person-circle fs-5"></i>
          </button>
        </ng-template>
      </div>

    </div>

    <div class="card-grid">
      <div class="card shadow-sm" *ngFor="let cheese of paginatedCheeses" (click)="goToDetails(cheese.id!)">
        <div class="image-placeholder">
          <img [src]="'https://localhost:443/api/v1/cheeses/' + cheese.id + '/image'"
            alt="Imagen de {{ cheese.name }}" />
        </div>
        <div class="card-body">
          <p>{{ cheese.name }}</p>
          <p class="price">{{ cheese.price | currency }}</p>
        </div>
      </div>

      <div class="card add-card" (click)="goToNewCheese()" *ngIf="isLoggedIn && isAdmin()">
        <div class="add-content">
          <span class="plus">+</span>
          <p>Nuevo Queso</p>
        </div>
      </div>
    </div>

    <!-- Paginación -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <nav aria-label="Paginación de quesos">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
              Anterior
            </button>
          </li>

          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <button class="page-link" (click)="goToPage(page)">
              {{ page }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">
              Siguiente
            </button>
          </li>
        </ul>
      </nav>
      <p class="text-center text-muted mt-2">
        Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} -
        {{ Math.min(currentPage * itemsPerPage, filteredCheeses.length) }}
        de {{ filteredCheeses.length }} quesos
      </p>
    </div>

  </main>
</div>